<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Admin - Review List</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
  <style>
    .rating { color: #ffc107; }
    .pagination .page-link { cursor: pointer; }
  
    body {
      background-color: #f1f3f5;
    }
    .sidebar {
      height: 100vh;
      position: fixed;
      top: 0;
      left: 0;
      width: 220px;
      background-color: #343a40;
      color: #fff;
      padding-top: 60px;
    }
    .sidebar a {
      color: #fff;
      display: block;
      padding: 10px 20px;
      text-decoration: none;
    }
    .sidebar a:hover {
      background-color: #495057;
    }
    .main {
      margin-left: 220px;
      padding: 20px;
    }
  
  </style>
</head>
<body class="bg-light">
  <div class="sidebar">
    <h4 class="text-center">Admin</h4>
    <a href="../../Views/ADM/admin.html"><i class="bi bi-speedometer2"></i> Dashboard</a>
    <a href="../../Views/ADM/admin-user.html"><i class="bi bi-people"></i> Users</a>
    <a href="../../Views/ADM/admin-role.html"><i class="bi bi-people"></i> Role</a>
    <a href="../../Views/ADM/admin-categories.html"><i class="bi bi-grid"></i> Categories</a>
    <a href="../../Views/ADM/admin-courses.html"><i class="bi bi-book"></i> Courses</a>
    <a href="../../Views/ADM/admin-coursediscount.html"><i class="bi bi-book"></i> Course Discount</a>
    <a href="../../Views/ADM/admin-enrollment.html"><i class="bi bi-grid"></i> Enrollment</a>
    <a href="../../Views/ADM/admin-exercise.html"><i class="bi bi-book"></i> Exercise</a>
    <a href="../../Views/ADM/admin-lessons.html"><i class="bi bi-book"></i> Lessons</a>
    <a href="../../Views/ADM/admin-lessoncomment.html"><i class="bi bi-book"></i> Lessons</a>
    <a href="../../Views/ADM/admin-lessonresource.html"><i class="bi bi-book"></i> Lessons Resource</a>
    <a href="../../Views/ADM/admin-module.html"><i class="bi bi-grid"></i> Module</a>
    <a href="../../Views/ADM/admin-message.html"><i class="bi bi-grid"></i> Message</a>
    <a href="../../Views/ADM/admin-submission.html"><i class="bi bi-grid"></i> submission</a>

    <a href="#"><i class="bi bi-gear"></i> Settings</a>
  </div>
  <div class="container mt-5">
    <h2 class="mb-3">Danh sách đánh giá khóa học</h2>

    <!-- Tìm kiếm -->
    <div class="input-group mb-3">
      <input type="text" id="searchInput" class="form-control" placeholder="Tìm theo học viên hoặc khóa học..." oninput="applySearch()">
    </div>

    <!-- Bảng -->
    <table class="table table-bordered table-hover bg-white">
      <thead class="table-primary">
        <tr>
          <th>#</th>
          <th>Học viên</th>
          <th>Khóa học</th>
          <th>Đánh giá</th>
          <th>Nhận xét</th>
          <th>Ngày tạo</th>
          <th>Hành động</th>
        </tr>
      </thead>
      <tbody id="reviewTableBody"></tbody>
    </table>

    <!-- Phân trang -->
    <nav>
      <ul class="pagination justify-content-center" id="pagination"></ul>
    </nav>
  </div>

  <script>
    const reviews = [
      { id: 1, userName: "Nguyễn Văn A", courseTitle: "Java Cơ Bản", rating: 5, comment: "Tốt!", created_at: "2024-05-01" },
      { id: 2, userName: "Trần Thị B", courseTitle: "Spring Boot", rating: 4, comment: "Hay và dễ hiểu", created_at: "2024-05-02" },
      { id: 3, userName: "Lê Minh C", courseTitle: "ReactJS", rating: 3, comment: "Tạm ổn", created_at: "2024-05-03" },
    ];
    for (let i = 4; i <= 21; i++) {
      reviews.push({
        id: i,
        userName: "Học viên " + i,
        courseTitle: "Khóa " + (i % 5 + 1),
        rating: (i % 5) + 1,
        comment: "Nhận xét dòng " + i,
        created_at: "2024-05-" + ((i % 28) + 1).toString().padStart(2, "0"),
      });
    }

    const rowsPerPage = 10;
    let currentPage = 1;
    let filteredReviews = [...reviews];

    function applySearch() {
      const keyword = document.getElementById("searchInput").value.toLowerCase().trim();
      filteredReviews = reviews.filter(r =>
        r.userName.toLowerCase().includes(keyword) ||
        r.courseTitle.toLowerCase().includes(keyword)
      );
      currentPage = 1;
      renderTable();
      renderPagination();
    }

    function renderTable() {
      const tbody = document.getElementById("reviewTableBody");
      tbody.innerHTML = "";

      const start = (currentPage - 1) * rowsPerPage;
      const end = start + rowsPerPage;
      const pageData = filteredReviews.slice(start, end);

      pageData.forEach((r, idx) => {
        const stars = "★".repeat(Math.floor(r.rating)) + (r.rating % 1 ? "½" : "");
        tbody.innerHTML += `
          <tr>
            <td>${start + idx + 1}</td>
            <td>${r.userName}</td>
            <td>${r.courseTitle}</td>
            <td class="rating">${stars}</td>
            <td>${r.comment}</td>
            <td>${r.created_at}</td>
            <td>
              <button class="btn btn-sm btn-warning me-1" onclick="editReview(${r.id})">Sửa</button>
              <button class="btn btn-sm btn-danger" onclick="deleteReview(${r.id})">Xóa</button>
            </td>
          </tr>`;
      });
    }

    function renderPagination() {
      const totalPages = Math.ceil(filteredReviews.length / rowsPerPage);
      const pagination = document.getElementById("pagination");
      pagination.innerHTML = "";

      if (totalPages <= 1) return;

      for (let i = 1; i <= totalPages; i++) {
        pagination.innerHTML += `
          <li class="page-item ${i === currentPage ? 'active' : ''}">
            <a class="page-link" onclick="gotoPage(${i})">${i}</a>
          </li>`;
      }
    }

    function gotoPage(page) {
      currentPage = page;
      renderTable();
      renderPagination();
    }

    function deleteReview(id) {
      if (confirm("Bạn có chắc chắn muốn xóa đánh giá này không?")) {
        const index = reviews.findIndex(r => r.id === id);
        if (index !== -1) {
          reviews.splice(index, 1);
          applySearch();
        }
      }
    }

    function editReview(id) {
      alert("Chuyển tới trang chỉnh sửa review ID: " + id);
      // Có thể redirect như: window.location.href = `/admin/review/edit/${id}`;
    }

    // Khởi tạo
    applySearch();
  </script>
</body>
</html>
